%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\documentclass[apj]{emulateapj}
%\documentclass[preprint2]{aastex61}
%\documentclass[12pt,preprint]{aastex}
\graphicspath{{figures/}}
\DeclareGraphicsExtensions{.jpg,.pdf,.png,.eps,.ps}

\usepackage[table,usenames,dvipsnames]{xcolor}
%\usepackage{amsmath}
%\usepackage{subfigure}
\usepackage[backref,breaklinks,colorlinks,citecolor=blue]{hyperref}
\usepackage{natbib}
%\usepackage{natbib}
\bibliographystyle{fapj}
%\usepackage{graphicx}
%\usepackage{multirow}

\newcommand{\sqdeg}{deg$^2$ }
\newcommand{\omb}{\ensuremath{\Omega_b h^2}}
\newcommand{\omc}{\ensuremath{\Omega_c h^2}}
\newcommand{\clpp}{\ensuremath{C_{L}^{\phi\phi}}}
\newcommand{\cpmf}{\ensuremath{C_{\ell}^{\rm pmf}}}
\newcommand{\apmf}{\ensuremath{A_{\rm pmf}}}
\newcommand{\bpmf}{\ensuremath{B_{\rm 1\,Mpc}}}
\newcommand{\alens}{\ensuremath{A_{\rm lens}}}
\newcommand{\lcdm}{\ensuremath{\Lambda}CDM}
\newcommand{\nrun}{\ensuremath{n_{\rm run}}}
\newcommand{\neff}{\ensuremath{N_{\rm eff}}}
\newcommand{\ho}{H\ensuremath{_0}}
\newcommand{\mnu}{\ensuremath{\sum m_\nu}}
\newcommand{\ukarcmin}{\ensuremath{\mu}K-arcmin}
\newcommand{\lknee}{\ensuremath{\ell_{\rm knee}}}
\newcommand{\fermilat}{\textit{Fermi}-LAT}

\newcommand{\be}{\begin{equation}}
\newcommand{\ee}{\end{equation}}
\newcommand{\planck}{{\sl Planck}}
\newcommand{\wmap}{{\sl WMAP}}
\newcommand{\bicepkeck}{BICEP2/Keck Array}
\newcommand{\sptnew}{SPT-3G}
\newcommand{\pb}{POLARBEAR}
\newcommand{\simons}{Simons Array}
\newcommand{\sptpol}{SPTpol}
\newcommand{\advactpol}{Adv.~ACTpol}

\newcommand{\tbd}[1]{\textcolor{Red}{{\bf TBD}: #1}}
\newcommand{\gab}[1]{\textcolor{Orchid}{[{\bf GS}: #1]}}

\include{number_list}

%

% ref to section \S\ref{sec:label}

%\submitjournal{ApJ}
\def\Melbourne{1}
\def\uci{2}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}

\title{Current and future constraints on primordial magnetic fields}
\author{D.~Sutton\altaffilmark{\Melbourne}, C.~Feng\altaffilmark{\uci}, and C.~L.~Reichardt\altaffilmark{\Melbourne}}
\altaffiltext{\Melbourne}{School of Physics, University of Melbourne, Parkville, VIC 3010, Australia}
\altaffiltext{\uci}{Department of Physics and Astronomy, University of California, Irvine, CA 92697-4575, USA}
\email{christian.reichardt@unimelb.edu.au}

\begin{abstract}

We present new limits on the amplitude of potential primordial magnetic fields (PMFs) using temperature and polarization measurements of the cosmic microwave background (CMB)  from \planck{}, \bicepkeck{}, \pb, and \sptpol. 
We reduce twofold the upper limit on the CMB anisotropy power due to a PMF, from $\apmf < \upperAplk$ from Planck alone to $\apmf < \upperAall$ for the combined dataset at 95\% CL. 
%Most of the improvement is due to the addition of the \bicepkeck{} data; without these bandpowers, the combined limit weakens to $\apmf < 0.\tbd{XX}$. 
We also forecast the expected future limits from soon-to-deploy CMB experiments (like \sptnew{},  \advactpol, or the \simons) and the proposed CMB-S4 experiment. 
Future CMB experiments should dramatically reduce the current uncertainties, by two orders of magnitude for the near-term experiments and three orders of magnitude for the CMB-S4 experiment. 
The constraints from CMB-S4 have the potential to rule out much of the parameter space for PMFs.

\end{abstract}

\keywords{dark energy --- cosmic background radiation --- early universe }
\section{Introduction}
\label{sec:intro}

Measurements of the cosmic microwave background (CMB) temperature anisotropy have provided some of the most powerful tests of cosmology. 
We are now entering a new era as experiments begin to measure  polarized ``B-modes" in the CMB for the first time \citep{hanson13,polarbear14b,bicep14a,naess14,keisler15,bicepkeck15,louis16}. 
Precision measurements of CMB polarization promise new tests of the standard cosmological model. 
The best known of these tests are the searches for inflationary gravitational waves in B-modes at large angular scales and plans to measure the sum of the neutrino masses through the lensing B-modes on small angular scales \citep[for a recent review see,][]{abazajian16}. 

CMB B-mode measurements can also be used to constrain more exotic models, such as the possible existence of cosmic birefringence \citep{carroll98,lue99} or primordial magnetic fields (PMFs) \citep{kosowsky96, seshadri01}.  
Both effects lead to the rotation of E-modes into B-modes. 
By equating the magnitude of the resulting B-modes, parity-violating processes can be translated into an equivalent PMF strength. 
It is therefore common to simply quote effective limits on PMFs. 
In this work, we present new upper limits from current CMB polarization data on the possibility of a PMF or parity-violating physics. 

Magnetic fields are ubiquitous in astronomy and are found almost universally in collapsed objects from stars to galaxies and galaxy clusters \citep[for a review, see][]{ryu12, widrow12}. 
There is even some evidence for magnetic fields in intergalactic space from \fermilat{} data \citep{neronov10}, although there are alternative explanations \citep{broderick12}. 
High energy $\gamma$-rays from blazars should  produce electron-positron pairs when the $\gamma$-rays collide with IR or optical photons. 
These pairs should later annihilate in at GeV energies, but the expected GeV flux is missing in the \fermilat{} observations. 
The missing flux could be explained by the deflection of particles due to intergalactic magnetic fields. 
If this is indeed the case then the GeV results set lower limits on the intergalactic magnetic field strength of $10^{-9} - 10^{-6}$\,nG \citep{tavecchio10,taylor11,dermer11,vovk12}. 


The mechanism to create large-scale magnetic fields, especially in intergalactic space, remains unclear. 
One popular proposal is that the observed fields are the product of PMFs, which are predicted by several theories of the early Universe \citep[e.g.,][]{turner88, grasso98,ichiki06}. 
Adiabatic compression and turbulent shocks during later structure formation amplify these initial seed PMFs into the stronger fields observed today. 
Of course, this amplification process may be seeded through other means, such as AGN or galactic dynamos \citep[for a review, see][]{giovannini04}. 
However, the possibility of PMFs opens up the intriguing idea that observations of large-scale magnetic fields may offer insights into the physics of the very early Universe. 


PMFs would have observational consequences for Big Bang nucleosynthesis \citep[e.g.,][]{kahniashvili10}, large scale structure \citep[e.g.,][]{battaner97}, the ionization history of the Universe \citep{kunze15}, and the black body spectrum of the CMB \citep[e.g.,][]{kunze14},  as well as the CMB anisotropies. 
The CMB anisotropies have yielded some of the strongest constraints on PMFs and are the focus of this work.
There have been three recent results of note. 
\citet{planck15-19} have used the \planck{} 2015 release of temperature and polarization data to set limits on a variety of PMF models. 
With the CMB power spectrum data that will be the focus of this paper, \citet{planck15-19} find 95\% CL upper limits ranging from $\bpmf < 5.6$\,nG to $<0.7$\,nG depending on the exact model. 
Here \bpmf{} is the rms field strength on a 1\,Mpc length scale. 
The \pb{} collaboration also recently announced limits on PMFs from the \pb{} data using either a 4-point estimator or B-mode power spectrum measurement in \citep{polarbear15}. 
The strongest constraints were from the B-mode spectrum; the observed upper limit was $\bpmf < 3.9$\,nG. 
Two other experiments, \sptpol{} and \bicepkeck{}, have reported B-mode power spectrum measurements recently \citep{keisler15,bicepkeck15}, 
and \citet{zucca16} reported constraints from the combination of the \planck{}  and \sptpol{} bandpowers. 
In this paper, we will combine the data from all four experiments to determine upper limits on PMFs, and find that the \bicepkeck{} data in particular improves these upper limits. 
We then present Fisher matrix forecasts on PMF models for the stage-III and stage-IV CMB experiments being built or designed right now. 



The outline of this paper is as follows. 
In \S\ref{sec:data}, we lay out the data and how we use the data to put limits on PMFs. 
We present the results of this analysis on current data in \S\ref{sec:results}. 
In \S\ref{sec:forecasts}, we forecast constraints from future experiments using a Fisher matrix formulism. 
We conclude in \S\ref{sec:conclusions}. 

\section{Data and Methods}
\label{sec:data}

We use  Markov chain Monte Carlo (MCMC) methods to study constraints on PMFs. 
In this section, we first describe the CMB temperature and polarization anisotropy data used, and then discuss the MCMC implementation. 




\subsection{Data}

We use a compendium of current measurements of the CMB temperature and polarization anisotropies from ground-based and satellite experiments. 
We use \planck{} data from the 2015 release to constrain the TT, TE, EE and lensing power spectra. 
Specifically, these are the ``plik\_dx11dr21\_HM\_v18\_TT", ``lowTEB" and ``lensing" \planck{} likelihood modules. 


In addition to the \planck{} data, we use a number of recent CMB B-mode polarization measurements. 
First, we include measurements of the TE, EE and BB power spectra from the \sptpol{} experiment \citep{crites15,keisler15}. 
The BB bandpowers cover the angular multipoles $\ell \in [500,2000]$. 
We also add the BB bandpowers from \pb{} that cover the multipoles from 500 to 2500 \citep{polarbear15}. 
At these angular scales, both the \sptpol{} and \pb{} bandpowers primarily constrain the vector modes of a PMF. 
Finally, we include the latest BICEP2 and Keck Array  joint analysis \citep{bicepkeck15}. 
This latter dataset also places limits on the tensor modes of a PMF due to its coverage of lower multipoles. 
During the writing of this work, ACTpol polarization power spectra became available \citep{naess14,louis16}. 
We have not included them as the public likelihoods do not include the B-mode power spectrum; we do not expect adding the ACTpol bandpowers to significantly change the PMF limits based on a visual comparison of the current BB bandpowers from different experiments (see Fig.~\ref{fig:pmf-experiments}).
In all chains, we marginalize over the recommended foreground models for each data set. 
We do not however require consistency between these foreground models since the data don't have identical flux cuts for extragalactic sources and so on. 
%In the case of an upper limit this treatment is conservative since wider foreground priors should only weaken the limit on the PMF strength. 
These data are plotted against the expected B-mode power spectrum for the standard cosmological model in Fig.~\ref{fig:pmf-experiments}. 

\subsection{Methods}

We use MCMC methods to determine the parameter constraints reported in this work. 
The results are calculated using  the {\textsc CosmoMC}\footnote{http://cosmologist.info/cosmomc (July 2015 version)} package \citep{lewis02b}. 
CosmoMC invokes  CAMB\footnote{http://camb.info}  \citep{lewis00} to calculate the CMB power spectrum for each set of cosmological parameters. 
Although CosmoMC and CAMB have a partial implementation of PMF, we choose to adopt a simpler, fast template-based calculation for the PMF power. 
We have adapted CosmoMC to add a scaled version of the template to all four CMB power spectra: TT, TE, EE, and BB, where the scale factor is \apmf. 
\be
C_\ell = C_\ell (CAMB) + \apmf \cpmf
\ee
The calculation of the PMF template, \cpmf, is described in \S\ref{sec:template}. 
Note that no other effect of the PMF is considered; this is one reason we only consider CMB data.

For the real data, unless noted, we assume the six-parameter, spatially-flat \lcdm{} model with a single massive neutrino of 60\,meV and a seventh parameter \apmf{} describing the power due to the PMF. 
We adopt flat priors on all parameters. 
In particular, note that this is a flat prior on the observed PMF power, $\apmf$, not the rms magnetic field strength, \bpmf, that has often been used in the literature. 
In many chains, we also add \alens{} as a simple way of marginalizing over uncertainty in the predicted lensed BB power spectrum for any extension to the \lcdm{} model. 
Finally, in some cases, we allow non-zero tensors, parameterized by the tensor-to-scalar ratio, r. 

\subsection{Primordial Magnetic Field Template}
\label{sec:template}

The density and stress perturbations introduced by PMFs give rise to vorticity and gravitational waves in the early photon-baryon  plasma, i.e. vector and tensor modes, as well as scalar modes. 
The exact amplitude of these modes can be calculated by modifying the normal Boltzmann equations to includes sources due to the PMFs. 
The PMF anisotropy is assumed to be drawn from a Gaussian distribution with a power law power spectrum, $A_b k^{n_b}$, with $n_b$ the spectral index and $A_b$ the PMF power. 
We can translate the power, $A_b$, into more physically-motivated units by calculating the rms of the PMF field strength over a length scale of 1\rm{Mpc}, thereby defining $B_{\rm{1Mpc}}$. 
Finally, the timing of when the PMFs are generated matters because the PMF-induced stress anisotropy can be compensated by decoupled or partially-decoupled neutrinos. 
The timing is typically parametrized by the ratio of the scale factors at neutrino decoupling and PMF generation, $a_{\nu}/a_{\rm{PMF}}$. 

Given that we are still in the era of upper limits,  we do not explore the full 3-dimensional PMF parameter space in this work. 
Instead, we use publicly released modifications to CAMB from \citet{zucca16} to calculate a PMF template for the CMB TT, TE, EE and BB power spectra at fixed parameters: $B_{\rm{1Mpc}}$=2.5 \rm{nG}, $n_b$=-2.9 and $a_{\nu}/a_{\rm{PMF}}=10^9$. 
We also look at $n_b=-1$ and $n_b=2$ in the forecasting section. 
We have compared calculated templates to the outputs of the earlier CMBACT code\footnote{\url{http://www.sfu.ca/~levon/cmbact.html}} \citep{pogosian99}, and find excellent agreement as would be hoped. 
The decision to use the  \citet{zucca16} code instead of CMBACT was based on the need to extend the calculation out to $\ell=10000$ for the Fisher matrix forecasts. 
The calculated templates include tensor and vector PMF contributions; scalar contributions are not implemented in the code. 
We expect the missing scalar power to degrade the \planck-only results in this work.
However the missing scalar power should be  unimportant for the EE and BB spectra that are driving the tightest constraints, particularly when looking at forecasts for the next generation of experiments. 
The PMF template is plotted against other signals in the CMB B-mode power spectrum in Fig.~\ref{fig:pmf-bb}. 
In the MCMC, we add a new scaling parameter, $A_{pmf}$, that rescales the PMF power spectrum template. 
We can translate the amplitude constraint on this template to a constraint on the rms magnetic field strength on 1\,Mpc scales, \bpmf, using the expected scaling:
\be
\apmf \propto \bpmf^4.
\ee
Note that the power in the tensor modes also depends on the timing of PMF generation relative to neutrino decoupling, which is not captured in the above expression. 
An unfortunate consequence of this steep fourth-power scaling is that substantial reductions in the observationally allowed vector-mode power lead to only modestly better limits on the magnetic field strength. 
However, if a PMF is detected, this same steep scaling would allow excellent constraints on its properties.

\begin{figure*}[htb]\centering
\includegraphics[width=0.9\textwidth,clip,trim={1.5cm 12.5cm 5cm 3.8cm}]{pmf_experiments.pdf}
  \caption[Current measurements of CMB B-modes]{
  Current measurements of CMB B-modes. 
    The black line shows the expected B-mode power in the \planck{} best-fit \lcdm{} cosmology (with the tensor-to-scalar ratio, r set to 0.01). 
    The B-mode measurements used for the limits in this work are denoted with filled circles; data not used has an open circle. 
    The data sets are from POLARBEAR (black circles; \citet{polarbear14b}); ACTpol (dark green triangles; \citet{naess14});  BICEP2/Keck Array (red diamonds; \citet{bicepkeck15}); and SPTpol (purple squares; \citet{keisler15}). 
      Current B-mode measurements are noise-limited at all angular multipoles; the next generation of experiments is expected to significantly increase the signal-to-noise on the B-mode power spectrum. 
           \label{fig:pmf-experiments}
  }
\end{figure*}

\begin{figure*}[htb]\centering
\includegraphics[width=0.9\textwidth,clip,trim={1.5cm 12.cm 5cm 4cm}]{pmf_templates.pdf}
  \caption[CMB polarization from PMFs]{
  The expected contributions to CMB B-modes. 
  The red line shows the expected lensing B-mode power in the \planck{} best-fit \lcdm{} cosmology. 
  The dark green line corresponds to the contribution from inflationary gravitational waves for $r=0.05$; the solid black line is the sum of the inflationary gravitational wave and lensing B-modes. 
  The dashed purple line shows the nearly-scale invariant ($n_b=-2.9$) PMF template used in this work, scaled to \apmf{} = 0.2 (i.e.~\bpmf{}=1.7\,nG) to match the gravitational wave signal. 
  As can be seen, the tensor contribution from PMFs at large angular scales (low $\ell$) closely resembles the expected inflationary gravitational wave signal, and the two signals are effectively degenerate in a power spectrum (2-point) analysis.
  %However, if excess power on these scales is detected, higher order moments of the map (i.e.~4-point estimators) might be used to discriminate between   the inflationary and PMF explanations. 
      \label{fig:pmf-bb}
  }
\end{figure*}

\begin{figure}[htb]\centering
\includegraphics[width=0.45\textwidth,clip,trim={1.5cm 12.cm 5.5cm 4cm}]{pmf_templates_nb.pdf}
  \caption[CMB polarization from PMFs with different spectral indices]{ \label{fig:pmf-nb}
  How the expected PMF changes with the spectral index, $n_B$. 
  The lensing B-mode power spectrum (solid, black line) are plotted against the PMF power for $n_B=-2.9$ (solid, purple line), $n_B=-1$ (dashed, green line), and $n_B=+2$ (dotted, red line). 
  To keep all the curves on the same scale, we adjust the RMS strength of the magnetic field, \bpmf{}, between the three cases as noted in the legend. 
  At fixed RMS magnetic field strength, increasing $n_B$ greatly increases the expected B-mode power. 
  There is an inflection point between the nearly-scale-invariant PMF with $n_b=-2.9$ and the bluer PMF spectra ($n_b=-1$ or 2) which shifts power to smaller angular scales. 
  }
\end{figure}
 
\section{Results}
\label{sec:results}

We find the addition of ground-based CMB polarization data to \planck{} data substantially improves the upper limits on the allowed power due to a PMF, leading to a factor of two improvement. 
With Planck alone, the 95\% confidence upper limit is $\apmf <  \upperAplk$ for \lcdm{}+\apmf{}; with the ground-based experiments, this limit drops to $\apmf <  \upperAall$. 
We list the limits for the combined dataset  with different parameter sets in Table~\ref{tab:param_all}. 
Somewhat counterintuitively, the limits are slightly better with \alens{} allowed to vary (this is due to a mild preference for \alens{} above unity). 
In this case for  Planck alone, the 95\% confidence upper limit is $\apmf <  \upperAplkalens$, dropping to $\apmf <  \upperAallalens$ with the ground-based experiments. 
We test which datasets are important by adding single datasets to the \planck{} set in the simple \lcdm{}+\apmf{} cosmology, and find that the majority of this improvement is due to the \bicepkeck{} ($\apmf <  \upperAbicep$) and \sptpol{} ($\apmf <  \upperAsptpol$) B-mode power spectrum measurements. 
The other datasets do not have a large impact on the observed limits. 
In short, the reduction in the allowed upper limit on \apmf{} for a nearly-scale-invariant PMF spectrum ($n_b=-2.9$) is primarily due to a more accurate measurement of the B-mode power spectrum at large angular scales. 



We propagate these limits on the observed PMF power into limits on the magnetic field strength, \bpmf. 
We assume the scaling appropriate to the vector modes, i.e. $\apmf \propto \bpmf^4$,  applies to both vector and tensor modes. 
Given this assumed scaling, the observed upper limits with a flat prior on \apmf{} would lead to an apparent `detection' of \bpmf. 
We therefore importance sample the chains to generate a flat prior on \bpmf. 
We find a 95\% limit of $\bpmf < \upperBplk$\,nG for \planck{} alone,
This is somewhat better then the limit found by \citet{planck15-19} of $\bpmf < 2.0$\,nG with $n_B=-2.9$ held fixed as we've done. 
The difference is due to a difference in the calculated tensor PMF power (for the same parameters) between the XXX and YYY codes. 
Using the YYY code that \citet{planck15-19} used, we find a completely consistent upper limit of $\bpmf < 1.9$\,nG. 
Returning to the XXX code, the upper limit is only slightly reduced to $\bpmf < \upperBall$\,nG for the combined dataset. 
The improvement from adding more data is somewhat less than one might predict because the combined likelihood peaks somewhat above zero, whereas the \planck{}-only constraints peaks at zero. 
%We also stress that this should not be treated as a robust limit as the tensor PMF modes are crucial to the improvement, and the assumed scaling has not been tested for the tensor PMF. 
%We quote it nonetheless to illustrate that with a steep power law scaling, the relative improvement to \bpmf{} will be slower than the improvement to \apmf{} as more data is added.
These results are inconsistent (being higher) with the equivalent \planck{} + \sptpol{} upper limit quoted by \citet{zucca16}; we were unable to reproduce their listed upper limit for \planck{} + \sptpol{}. 













\begin{table}[tbh]
\begin{center}
\caption{\label{tab:param_all} Parameter Constraints}
\small
\begin{tabular}{l | c c c }
Model   & $A_{pmf}$ &$A_{lens}$&$r$\\
\hline
\lcdm{} + \apmf{} &  $< \upperAall$ & - & - \\
~~~+\alens{} & $< \upperAallalens$ &$ \medAlensall \pm  \sigmaAlensall$ &  -\\
~~~+\alens{}+r&  $< \upperAallalensr$&$ \medAlensRall \pm  \sigmaAlensRall$ & $<\upperRall$\\ 
\end{tabular}
\tablecomments{ 
In the minimal model, \lcdm{} + \apmf{}, current CMB power spectra data from \planck, POLARBEAR, SPTpol, and \bicepkeck{} place a 95\% CL upper limit on the PMF power of $\apmf < \upperAall$. 
This limit tightens slightly if tensor modes are allowed (r), or the amount of lensing is allowed to vary. 
In the case of r, the tightening is because the observed power at large angular scales is now split between PMFs or inflationary gravitational waves. 
In the case of \alens, it is because the preferred value for \alens{} is modestly above the predicted value of unity. 
Recall that the the PMF template is normalized to unity for \bpmf{} = 2.5\,nG.
} \normalsize
\end{center}
\end{table}


\section{Forecasts}
\label{sec:forecasts}

The sensitivity of CMB experiments is increasing rapidly due to the continuing growth in the number of detectors. 
\citet{abazajian16} thus defines four stages of CMB experiments. 
The current experiments (i.e.~the ones used for PMF constraints in the last section) are classified as Stage II experiments. 
Stage III experiments such as SPT-3G, the Simons Array, or AdvACTPol \citep{benson14,suzuki16,henderson16} have approximately ten times more detectors, and generically will start collecting data around 2017 and finish three to four years later.
In this section, we forecast the expected constraints from the EE and BB power spectrum measurements  of the Stage III experiments by combining forecasts for SPT-3G and the Simons Array. 
There is also a proposal to build a stage IV experiment, CMB-S4,  that would increase the detector counts by another order of magnitude and hopefully begin taking data in the early 2020s.
A pathfinder to CMB-S4, the Simons Observatory, was funded in 2016. 
We examine the likely PMF constraints from the EE and BB power spectrum measurements with CMB-S4, and consider which aspects of experimental or survey design are important to maximize the recovered information on PMFs.




\subsection{Methods and Experimental Parameters}

We use Fisher matrices to forecast the constraints on PMFs possible from each generation of experiment. 
The Fisher matrix, $\mathcal{F}_{ij}$, can be defined as:
\be
\mathcal{F}_{ij} = \frac{1}{2} \frac{\partial^2 \chi^2}{\partial p_i \partial p_j},
\ee
for parameters, p. 
The inverse of the Fisher matrix will be the covariance matrix for the parameters. 
While Fisher matrices underestimate the true uncertainties for non-Gaussian likelihoods \citep[see e.g.,][]{wolz12}, they 
 make it easy to combine different experiments and estimate the final parameter constraints. 
 


We include two external datasets in all forecasts. 
The first dataset is the expected measurements of the  TT, TE and EE spectra from the \planck{} satellite. 
We include \planck{} TT information in the multipole range $2\le \ell \le 3000$. 
Due to the importance of galactic foreground removal at large scales in polarization, we only use TE and EE information starting from $\ell = 30$. 
A prior on the optical depth of 0.005 is added to account for the expected optical depth constraint from the missing multipoles. 
Second, we include a 1\% external measurement of the Hubble constant, such as is expected from the Taipan experiment \citep{kuehn14}. 

One concern with combining Fisher matrices from different experiments is double-counting modes due to overlapping sky coverage. 
We avoid this problem in different ways in each of the CMB power spectra. 
For the TT and TE spectra, we avoid double-counting by only using the \planck{} measurements. 
We do not expect the future experiments to substantially improve upon \planck{} in these spectra which are already cosmic variance limited out to fairly high multipoles. 
We do the opposite for the EE and BB spectra. 
We do not include \planck{} BB information in any forecast, and  we throw away \planck{} EE data in the overlap region by appropriately increasing the \planck{} EE uncertainties. 
%The exact increase depends on the assumed stage III or IV survey area.
We ignore overlaps between the stage III  on the basis that the sky overlap between a Chilean experiment like the Simons Array and South Pole experiment like SPT-3G should be small. 
This is also why we do not include both Simons Array and AdvACTpol as the two experiments are likely to have substantial sky overlap. 
The overlapping sky coverage is expected to be substantial between stage III and IV experiments, thus we do not include the stage III experiments, except as a prior on the polarized Poisson power, in the CMB-S4 constraints. 
This prior is only relevant in practice when the assumed CMB-S4 configuration has a larger beam size than SPT-3G. 
With these measures, no modes should be double-counted in this analysis. 

\begin{table*}[tbh]
\begin{center}
\caption{\label{tab:experiments} Assumed survey parameters}
\small
\begin{tabular}{l || c c c c c }
Experiment & Sky coverage & Polarized Noise level  & 1/f knee & Beam FWHM \\
& &($\mu$K-arcmin)&&(arcmin.)\\
\hline
Stage III: & & & & \\

~~~~SPT-3G & 6\% & 3.0 & 200 & 1.2 \\
~~~~Simons Array & 36\% & 9.5 & 200 & 3.5 \\ 
\\
%\hline
CMB Stage IV & 55\% & 1.3 & 100 & 4.0 \\
\end{tabular}
\tablecomments{ 
Key numbers about the planned stage III and IV experiments. 
The sky coverage percentages are after galactic cuts. 
Unless otherwise noted,  the Fisher matrix forecasts in this work use these numbers. 
All forecasts also include beam and calibration uncertainties as noted in the text. 
} \normalsize
\end{center}
\end{table*}


We list the assumed survey areas, noise levels and beam sizes for each experiment in Table~\ref{tab:experiments}. 
We  assume a 5\% uncertainty on the beam FWHM and a 1\% power calibration uncertainty; we have tested relaxing or tightening the beam and calibration uncertainty and find these calibration terms have a negligible impact on the PMF constraints. 


We consider the constraints on PMFs in two cosmologies. 
The first is a 11-parameter model that extends \lcdm{} with 5 commonly considered extensions:  \lcdm{}  +r + \nrun{} + \neff{} + \mnu{}+ \apmf. 
This 11-parameter model is our default cosmological model for forecasting future PMF constraints. 
We have examined the degree to which \apmf{} is degenerate with the other 10 parameters -- the only strong degeneracy is with the tensor-to-scalar ratio, r. 
The reason for this degeneracy is illustrated in Fig.~\ref{fig:pmf-bb}, which shows that the tensor mode power due to inflationary gravitational waves and PMFs is nearly identical. 
To illustrate the degree to which parameter degeneracies limit the inferred constraints,  we also quote constraints from a `minimal' 7-parameter model in which the PMF power is the only extension to \lcdm{}:  \lcdm{}  + \apmf. 
In both cases, we also marginalize over unknown Poisson EE and BB  terms due to polarized extragalactic sources. 
We assume the galactic foregrounds are removed by a judicious combination of data from multiple frequencies. 


In this work, we only forecast the uncertainties due to power spectrum (i.e.~2-point estimators) searches for PMFs. 
Currently the power spectrum limits from \planck{} or \pb{} are better than the 4-point upper limits. 
Although outside the scope of this work, it would be interesting to extend this analysis to 4-point estimators for several reasons. 
First, the 4-point limits should improve faster as the noise level falls. 
Second, in the case of a detection, the 4-point estimators would almost certainly come into play to learn more about the vector modes of the PMFs. 
The detection (or non-detection) of the vector PMF signal in the 4-point estimators could also be used to argue for whether it is more likely that any observed tensor power is due to  inflationary gravitational waves or  PMFs. 
Finally, a lensing estimator might be used to `de-lense' the B-mode power spectrum, thereby suppressing the lensed B-mode signal and allowing better limits on PMFs. 
Such de-lensing techniques have long been proposed for inflationary gravitational wave searches \citep[e.g.][]{knox02,kesden02,seljak04a,simard15} and more recently been demonstrated on real \planck{} data \citep{larsen16}. 

%As a sanity check, we look at the Fisher matrix forecasts for Planck alone as well in both of these cases. 
%For both chains,  we look at the sigma in MCMC with \apmf{} allowed to go negative. 
%While a negative \apmf{} is unphysical, this insulates the analysis against the data preferring negative values, and thereby producing tighter limits. 
%We find for \lcdm{}  + \apmf{}: $\sigma(\apmf) = XX$ (to be compared to YY from the Fisher matrix). 
%We find for the 11-parameter model: $\sigma(\apmf) = XX$ (to be compared to YY from the Fisher matrix). 
%This degree of consistency is reasonable. \tbd{}

\subsection{Stage III forecasts}

The experiments that will begin taking data in 2017 will dramatically improve constraints on the PMF power. 
With the minimal cosmological model, the 1-sigma forecasts for \planck{}+\ho{} is $\sigma(\apmf)=\fisherAplk$ for a nearly-scale invariant PMF spectrum (i.e.~$n_b=-2.9$). 
This is consistent with, although somewhat better than, the upper limits from the real data).  
Adding the EE and BB bandpowers from the two stage III experiments (\sptnew{} and \simons{}) reduces the uncertainty by an order of magnitude in this 7-parameter model to $\sigma(\apmf)=0.015$. 
The improvement is larger when including all eleven parameters, as the parameter degeneracies substantially weaken (by a factor of five) the \planck+\ho{} constraints on \apmf{}, while only weakening the stage III constraint by a  more modest 40\%. 
Thus within the 11-parameter model however,  the addition of stage III CMB experiments improves the \apmf{} uncertainty by a factor of $\sim$\,35 to  $\sigma(\apmf)=0.022$. 
The parameter degeneracies largely disappear for steeper PMF spectra (i.e. $n_b=-1$ or 2) as the PMF B-mode spectra then peaks at very small scales and this small-scale power can not be mimicked by any of the other 11-parameters. 
The improvement for the CMB-S3 experiments over \planck{} remains impressive at a factor of 17 and 13 respectively. 
We can expect substantially tighter constraints on PMFs by the end of the decade. 

\subsection{Stage IV forecasts}

The primary motivation behind the proposed CMB stage IV experiment commonly called CMB-S4 is to search for inflationary gravitational waves and neutrino masses, however, the experiment should also enable extremely sensitive searches for PMFs. 
We look at the prospects for these searches using the polarization information (EE and BB power spectra) from CMB-S4. 
We begin by making forecasts for the fiducial CMB-S4 configuration as laid out in Table~\ref{tab:experiments}, and then consider how changing the experimental design would impact the expected uncertainties. 




\subsection{Survey considerations for Stage IV}

Given that CMB-S4 is still being designed, it is worthwhile to consider how design decisions will affect the final PMF constraints. 
We look at five aspects of the experiment design: the instrumental sensitivity (as reflect by the map noise level), the telescope size or beam FWHM,  the low-$\ell$ noise performance (1/f knee), the choice of survey area,  and how well the beam size and calibration must be known. 
Of these five, we find that the first two to be very important and the second two to be somewhat important when optimizing for searches for PMFs. 
As should be expected, the preferred design depends on the shape of the PMF spectrum ($n_B$) which controls  the relative power between large and small angular scales. 

\subsubsection{Instrumental sensitivity (map noise levels)}

We naturally expect more sensitive instruments to do a better job of constraining PMF models. 
The goal of this section is to quantify that statement for the three PMF templates considered in the 11 or 7-parameter cosmological models. 
Our results are shown in Fig.~\ref{fig:sensitivity}. 
For this figure, we have fixed the rest of the experimental configuration (i.e.~everything except the polarized noise levels) to the values of the CMB-S4 row in Table~\ref{tab:experiments}. 
Clearly, continuing to improve the sensitivity of CMB experiments to CMB-S4 and beyond will be a boon to PMF searches. 
In the general, 11-parameter cosmological model, the PMF uncertainty does not plateau in any of the three PMF templates considered till the map noise is at or below $0.3\,\ukarcmin$ (a factor of four lower then the fiducial CMB-S4 configuration). 


\begin{figure}[htb]\centering
\includegraphics[width=0.45\textwidth,clip,trim={1.5cm 12.5cm 11cm 7.5cm}]{pmf_sens.pdf}
  \caption[]{ \label{fig:sensitivity}
  How the expected uncertainty on the PMF power scales with the polarized map noise. 
  Forecasts are shown for each of the three PMF scalar indices: $n_B = -2.9$ (solid), -1 (dashed), and +2 (dash-dot). 
  The black lines are for the conservative 11-parameter model, while the blue lines are for the simple \lcdm{}+\apmf{} model. 
  The model only matters in the nearly-scale invariant PMF case, where the constraints degrade in the 11-parameter model due a degeneracy with the tensor-to-scalar ratio. 
  The PMF constraints improve rapidly with lower noise levels in all three cases up to $\sim$\,1\,\ukarcmin. 
    }
\end{figure}

\subsubsection{Size of Telescope }


\begin{figure}[htb]\centering
\includegraphics[width=0.45\textwidth,clip,trim={1.5cm 12.5cm 11cm 7.5cm}]{pmf_beam.pdf}
  \caption[]{ \label{fig:beam}
 Larger telescopes (and smaller beams) will improve limits on the PMF power. 
 Forecasts are shown for each of the three PMF scalar indices: $n_B = -2.9$ (solid), -1 (dashed), and +2 (dash-dot). 
  The black lines are for the conservative 11-parameter model, while the blue lines are for the simple \lcdm{}+\apmf{} model. 
  The model only matters in the nearly-scale invariant PMF case ($n_B=-2.9$), where the information on large angular scales dominates and the telescope size is relatively unimportant. 
    }
\end{figure}

Larger telescopes will allow CMB polarization to be measured on smaller angular scales, and should therefore always improve the PMF constraints. 
As shown in Fig.~\ref{fig:beam}, we find the gains due to resolution at fixed mapping speed to be substantial for all three power law indices considered.
 A beam size of FWHM=1$^\prime$ instead of 10$^\prime$ reduces the expected upper limit five-fold for $n_b=-2.9$ and 30- to 35-fold for the steeper PMF indices which are more heavily weighted towards small angular scales. 

However, larger telescopes are also more expensive to build which means for a fixed experimental budget, they would necessitate less ambitious focal planes and lower instantaneous mapping speed. 
We very crudely approximated a cost-neutral setup with a noise level of 1.3 \ukarcmin{} for a FWHM of 4$^\prime$; a noise level of 2.9 \ukarcmin{} for a FWHM of 2$^\prime$; and a noise level of 4.1 \ukarcmin{} for a FWHM of 1$^\prime$. 
We find 
Improving the mapping speed rather than telescope size leads to somewhat better potential limits for these experimental configurations, by a factor of 1.6, 1.2 or 1.1 for $n_b = -2.9, -1, +2$ respectively. 
However the results are close enough that the crudeness of the cost-neutral estimates used here could be a factor, and the preference might flip for more accurately costed setups. 
In short,  the tradeoff between larger telescopes or more detectors is largely a wash, although one would lean towards adding more detectors. 
Raw sensitivity is important to an experiment's ability to study PMFs.

\subsubsection{Survey Area}

\begin{figure}[htb]\centering
\includegraphics[width=0.45\textwidth,clip,trim={1.5cm 12.5cm 11cm 7.5cm}]{pmf_area.pdf}
  \caption[Area dependence]{
  The preferred survey area for PMF searches depends on the PMF spectral index. 
    In the scale-invariant $n_b = -2.9$ case (solid line), we find that observing more than $\sim$\,15\% of the sky is strongly preferred for PMF searches. 
 In contrast, for the cases where $n_b = -1, +2$ (dashed and dot-dashed lines), we find that observing  $\sim$\,10\% of the sky produces the best PMF constraints. 
   There is essentially no difference to the preferred areas between the 11-parameter cosmological model (black) or the restricted \lcdm{}+\apmf{} 7-parameter model (purple). 
     Fortunately, the minima for all three templates are relatively broad, and a survey covering 15+\% of the sky will do well for all values of the PMF spectral index. 
    \label{fig:area}
  }
\end{figure}


A second question is whether it is better to integrate deeply on a small patch of sky or observe a wide area. 
Unsurprisingly, we find opposing preferences for the scale-invariant $n_b=-2.9$ (which peaks at large scales) and the bluer $n_b=-1$ or 2 spectra peaking at small scales. 
As shown in  Fig.~\ref{fig:area}, for $n_b=-2.9$, observing at least 15\% of the sky is very important to a search for nearly scale-invariant PMFs, and it is best  to cover as much sky as possible. 
A caveat to this analysis is that it is likely easier to remove galactic foregrounds to a specified level on targeted, `clean' patches as opposed to a substantial fraction of the sky, and we would expect galactic foregrounds to be important for the large angular scales. 
With that said, the PMF constraints improve by a factor of 1.4-1.5 (depending on the cosmological model) going from 10\% to 25\% of the full sky, and are nearly flat (a 6\% improvement) from 25\% to 70\% of the sky (the widest area likely to be possible after galactic cuts).
Conversely, $n_b=+2$, the optimal survey area is smaller at 10\%. 
Note however that the minimum is extremely broad with only a 10\% worsening of the expected uncertainty as the survey area is increased from 10\% to 70\% of the  full sky. 
A survey of around 25\% of the sky would perform well for all three considered PMF models. 

\subsubsection{Noise performance at large angular scales}

\begin{figure}[htb]\centering
\includegraphics[width=0.45\textwidth,clip,trim={1.5cm 12.5cm 11cm 7.5cm}]{pmf_knee.pdf}
  \caption[Map knee dependence]{
  The forecasted uncertainty on the PMF power, \apmf{}, falls as expected with decreasing low-frequency map noise for a nearly scale-invariant PMF ($n_b = -2.9$) in the restricted \lcdm{}+\apmf{} 7-parameter model (solid, purple line). 
  However,  the achieved map 1/f knee frequency makes no difference to the potential power of CMB-S4 PMF searches in the 11-parameter model (solid, black line). 
  The change in behavior happens because the 11-parameter model introduces a degeneracy with r that shifts the angular scale of the PMF constraint to sub-degree scales. 
  The 1/f knee frequency also makes no difference for the bluer PMF templates in either the restricted or full 11-parameter model space (dashed and dash-dotted black lines). 
   for any value of $n_B$ (black lines). 
    \label{fig:knee}
  }
\end{figure}

Next we turn to the recovery of large angular scales, and the noise performance at low frequencies. 
We look at the impact of shifting the 1/f knee of the map-space noise. 
Effectively, we are multiplying the noise power, $N_\ell$, which is a constant for white noise,  by a function of angular multipole:
\be \label{eqn:knee}
f(\ell) = 1 + \left(\frac{\ell_{\rm knee}}{\ell}\right)^{8/3}.
\ee 
The exponent, 8/3, was selected based on a Kolmogorov spectrum of turbulence within a thin plane \citep{lay00}. %lay & halverson 2000. 
Note that this knob  serves as a placeholder for several effects, including a signal-to-noise hit due to galactic foregrounds or the methods used to clean these foregrounds, atmospheric noise, or actual instrumental 1/f noise. 

We generally find the forecasts to be insensitive to the 1/f knee or galactic foreground removal at the default beam size of 4$^\prime$. 
It appears that even in the nearly scale-invariant case, the PMF constraint is being driven by smaller angular scales due to the the degeneracy with the tensor-to-scalar ratio at large angular scales. 
Without this degeneracy, i.e. in the simple \lcdm{}+\apmf{} model, dropping \lknee{} from 400 to 50 reduces the uncertainty by a factor of 3.2 for a nearly scale-invariant PMF. 
In this case, the degradation accelerates once the 1/f knee goes above $\ell \simeq 70$. 
This is consistent with the statement for the same simple model that the current upper limits are dominated by the BICEP2/Keck Array data at low-$\ell$. 
For the bluer PMF spectra ($n_b=-1$ or 2), the forecasts have nearly zero dependence on the knee frequency. 
These results are consistent with the study of telescope size in the last section - which found that recovering smaller angular scales with larger telescopes helped (if one didn't consider cost).
For a conservative 11-parameter model, our ability to separate a PMF from other physics is coming from sub-degree angular scales. 
An instrument built to precisely measure gravitational lensing of the CMB should do very well at searching for PMFs. 


\subsubsection{Beam and calibration uncertainties}

Finally, we consider if searches for PMFs introduce new requirements on the accuracy to which the instrumental beam or overall calibration of an experiment must be known. 
We find they do not. 
We parameterize the beam uncertainty as a fractional uncertainty on the FWHM of the Gaussian beam, and calibration uncertainty as an overall power uncertainty. 
We find negligible, sub-percent shifts in the forecasted uncertainty for calibration uncertainties from 0.2 to 5\% and beam FWHM uncertainties from 2 to 12.5\%. 
The PMF constraints  for all three power law indices considered are insensitive to the beam and calibration uncertainties. 

\section{Conclusions}
\label{sec:conclusions}

In this work, we have improved the current upper limits on the strength of any primordial magnetic fields by including more CMB B-mode polarization data. 
By adding \bicepkeck{}, \pb, and \sptpol{} to \planck{} we find the 95\% CL upper limit on the PMF power falls nearly two-fold from $\apmf < \upperAplk$ to $\apmf < \upperAall$. 
The biggest contributor to this improvement is the low-$\ell$ data from \bicepkeck{}. 

We have also shown that the next generation of experiments should dramatically reduce these limits, and potentially detect PMFs for the first time. 
These so-called stage III experiments, which will begin taking data in 2017, expect to set upper limits at the level of $\apmf < 0.02$ even after marginalizing over a five-parameter extension to \lcdm.

The potential for detection increases even further with planned experiments like the Simons Observatory or CMB-S4. 
We show that an ideal version of CMB-S4 might decrease the 95\% CL upper limits eight-fold, to $\apmf < 0.00025$, and even non-ideal versions can easily set upper limits on order of $\apmf < 0.006$, i.e.~ a three-fold improvement over the forecasts for the stage III experiments and a 37-fold improvement over the current limits. 
We consider how the design of these experiments will impact the resulting PMF limits -- the experimental sensitivity, angular resolution, survey area, low-frequency noise performance, and beam or calibration uncertainties -- and find sensitivity followed by telescope size to be the most important factors in predicting the PMF limits. 
CMB-S4 will be a very exciting probe of PMFs and other sources of cosmic birefringence. 

\acknowledgments

We thank Srinivasan Raghunathan and Federico Bianchini for valuable feedback on the manuscript. 
C. Reichardt is the recipient of an Australian Research Council Future Fellowship (FT150100074), and also acknowledges support from the University of Melbourne. 
CF acknowledges support from NASA grants NASA NNX16AJ69G and NASA NNX16AF39G. 
This research used resources of the National Energy Research Scientific Computing Center, which is supported by the Office of Science of the U.S. Department of Energy under Contract No. DE-AC02-05CH11231. 
We acknowledge the use of the Legacy Archive for Microwave Background Data Analysis (LAMBDA). Support for LAMBDA is provided by the NASA Office of Space Science.


\bibliography{pmf}


\end{document}
